Bootstrap: docker
From: continuumio/miniconda3

%help
	Deep Learning software stack 


%labels
	AUTHOR_NAME Philipp Hess
	AUTHOR_EMAIL hess@pik-potsdam.de
	VERSION 1.0

%files
	environment.yaml /

%environment
	export LC_ALL=C

%post
	export PATH="/opt/conda/bin:$PATH"

	apt update
	apt install -y build-essential
 	conda update conda
    	conda create -n singularity
	conda env update -n singularity -f /environment.yaml
	/opt/conda/envs/singularity/bin/pip install --extra-index-url https://developer.download.nvidia.com/compute/redist --upgrade nvidia-dali-cuda102

	conda list -n singularity

    	#/opt/conda/envs/singularity/bin/jupyter labextension install -y --clean \
    	#    @jupyter-widgets/jupyterlab-manager \
    	#    dask-labextension


%runscript
    exec /opt/conda/envs/singularity/bin/"$@"

